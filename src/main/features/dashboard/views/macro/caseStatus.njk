{% from "timeRemaining.njk" import timeRemaining %}

{% macro _viewResponseLink (externalId) %}
  <a href="{{ ResponsePaths.summaryPage.evaluateUri({ externalId: externalId }) }}">{{ t('View full response') }}</a>
{% endmacro %}

{% macro caseStatusForDefendant(status, claim, url, isAfter4pm) %}
  {% set claimantName = claim.claimData.claimant.name %}
  {% if status === ClaimStatus.OFFER_SETTLEMENT_REACHED %}
    {{ t('You’ve both signed a legal agreement. The claim is now settled.') }}
  {% elseif status === ClaimStatus.ELIGIBLE_FOR_CCJ %}
    {{ t('You did not respond by the deadline. {{ claimantName }} can request a County Court Judgment (CCJ) against you. '
    + 'You can still respond until they do.',
    { claimantName: claimantName } ) }}
  {% elseif status === ClaimStatus.CCJ_REQUESTED %}
    {{ t('{{ claimantName }} requested a County Court Judgment against you on {{ ccjRequestedAt }}. '
      + 'We will contact you both within 5 working days.',
      { claimantName: claimantName, ccjRequestedAt: claim.countyCourtJudgmentRequestedAt | date }) }}
  {% elseif status === ClaimStatus.CLAIM_REJECTED %}
    {% if claim.response.defenceType === DefenceType.ALREADY_PAID %}
      {{ t('We’ve emailed {{ claimantName }} telling them when and how you paid the claim.', { claimantName: claimantName }) }}
    {% else %}
      {% if claim.response.freeMediation === FreeMediationOption.YES %}
        {{ t('You’ve rejected the claim and suggested mediation on {{ respondedAt }}.',
          { respondedAt: claim.respondedAt | date }) }}
      {% else %}
        {{ t('You’ve rejected the claim. The case will be reviewed by a judge and might go to court.' ) }}
      {% endif %}
    {% endif %}
  {% elseif status === ClaimStatus.OFFER_ACCEPTED %}
    {{ t('The claimant has accepted your offer. You need to sign a legal agreement to settle out of court.') }}
  {% elseif status === ClaimStatus.OFFER_REJECTED %}
    {{ t('{{ claimantName }} has rejected your offer.', { claimantName: claimantName }) | safe }}
  {% elseif status === ClaimStatus.OFFER_SUBMITTED %}
    {{ t('You made an offer to settle out of court.') }}
  {% elseif status === ClaimStatus.MORE_TIME_REQUESTED %}
    {{ t('You need to respond by {{ responseDeadline }}. You asked for an extra 14 days to respond.',
    { responseDeadline: claim.responseDeadline | date }) }}
  {% elseif status === ClaimStatus.NO_RESPONSE %}
    <a href="{{ url }}">{{ t('Respond to claim') }}</a>
    <span class="block mobile-inline">
      {{ timeRemaining(claim.remainingDays, isAfter4pm) }}
    </span>
  {% endif %}
{% endmacro %}

{% macro caseStatusForClaimant(status, claim, url) %}
  {% set defendantName = claim.claimData.defendant.name %}
  {% if status === ClaimStatus.CCJ_REQUESTED %}
    {{ t('You requested a County Court Judgment on {{ ccjRequestedAt }}. We will contact you within 5 working days.',
    { ccjRequestedAt: claim.countyCourtJudgmentRequestedAt | date }) }}
  {% elseif status === ClaimStatus.ELIGIBLE_FOR_CCJ %}
    <p>{{ t('You can request a County Court Judgment') }}</p>
  {% elseif status === ClaimStatus.OFFER_SETTLEMENT_REACHED %}
    {{ t('You both signed an agreement to settle out of court.') }}
    <p>
      <a href="{{ OfferPaths.agreementReceiver.evaluateUri({ externalId: claim.externalId }) }}">{{ t('Download the agreement') }}</a>
    </p>
  {% elseif status === ClaimStatus.CLAIM_REJECTED %}
    {% if claim.response.defenceType === DefenceType.ALREADY_PAID %}
      {{ t('The defendant believes that they’ve paid the claim in full.') }}
    {% else %}
      {% if claim.response.freeMediation === FreeMediationOption.YES %}
        {{ t('{{ defendantName }} has rejected the claim. '
          + 'They’ve suggested free mediation on {{ respondedAt }}. You can accept or reject',
          { defendantName: defendantName, respondedAt: claim.respondedAt | date }) }}
      {% else %}
        {{ t('{{ defendantName }} has rejected the claim. The case will be reviewed by a judge and might go to court.',
        { defendantName:  defendantName }) }}
      {% endif %}
      <p>{{ _viewResponseLink(claim.externalId) }}</p>
    {% endif %}
  {% elseif status === ClaimStatus.OFFER_ACCEPTED %}
    {{ t('You’ve signed the agreement. We’ve asked {{ defendantName }} to sign the agreement.',
    { defendantName: defendantName }) }}
  {% elseif status === ClaimStatus.OFFER_REJECTED %}
    {{ t('You’ve rejected an offer to settle out of court.') }}
  {% elseif status === ClaimStatus.OFFER_SUBMITTED %}
    {{ t('The defendant has made an offer to settle out of court.') }}
    <p>
      <a href="{{ url }}">{{ t('View their offer') }}</a>
    </p>
  {% elseif status === ClaimStatus.MORE_TIME_REQUESTED %}
    {{ t('{{ defendantName }} has requested an extra 14 days to respond. They need to respond by {{ responseDeadline }}.',
    { defendantName: defendantName, responseDeadline: claim.responseDeadline | date }) }}
  {% elseif status === ClaimStatus.NO_RESPONSE %}
    {{ t('Your claim has been sent. {{ defendantName }} has until {{ responseDeadline }} to respond. '
    + 'They can request an extra 14 days if they need it.',
    { defendantName: defendantName, responseDeadline: claim.responseDeadline | date }) }}
  {% endif %}
{% endmacro %}
