{% from "./caseStatus.njk" import caseStatusForClaimant, caseStatusForDefendant %}

{% from "./claimDetails/noReponse.njk" import noResponseForClaimantDashboard %}
{% from "./claimDetails/moreTimeRequested.njk" import moreTimeRequestedForClaimantDashboard %}

{% from "./claimDetails/ccjEligible.njk" import ccjEligibleForClaimantDashboard %}
{% from "./claimDetails/ccjRequested.njk" import ccjRequestedForClaimantDashboard, ccjRequesterForDefendantDashboard %}

{% from "./claimDetails/claimRejected.njk" import
  claimRejectedAlreadyPaidForClaimantDashboard,
  claimRejectedAlreadyPaidForDefendantDashboard,
  claimRejectedFreeMediationNOForClaimantDashboard,
  claimRejectedFreeMediationNOForDefendantDashboard,
  claimRejectedFreeMediationYESForClaimantDashboard,
  claimRejectedFreeMediationYESForDefendantDashboard %}

{% from "./claimDetails/offerSubmitted.njk" import offerSubmittedForClaimantDashboard, offerSubmittedForDefendantDashboard %}
{% from "./claimDetails/offerAccepted.njk" import offerAcceptedForClaimantDashboard, offerAcceptedForDefendantDashboard %}
{% from "./claimDetails/offerRejected.njk" import offerRejectedForClaimantDashboard, offerRejectedForDefendantDashboard %}
{% from "./claimDetails/offerSettlement.njk" import offerSettlementReachedDashboard %}

{% macro caseHistoryForClaimantDashboard(claim, url) %}
  {% for state in claim.stateHistory %}
    <div class="status-block">
      {% if state.status === ClaimStatus.NO_RESPONSE %}
        {{ noResponseForClaimantDashboard(claim) }}
      {% elif state.status === ClaimStatus.MORE_TIME_REQUESTED %}
        {{ moreTimeRequestedForClaimantDashboard(claim) }}
      {% elif state.status === ClaimStatus.ELIGIBLE_FOR_CCJ %}
        {{ ccjEligibleForClaimantDashboard(claim) }}
      {% elif state.status === ClaimStatus.CCJ_REQUESTED %}
        {{ ccjRequestedForClaimantDashboard(claim) }}
      {% elif state.status === ClaimStatus.CLAIM_REJECTED %}
        {% if claim.response.defenceType === DefenceType.ALREADY_PAID %}
          {{ claimRejectedAlreadyPaidForClaimantDashboard(claim) }}
        {% elif claim.response.freeMediation === FreeMediationOption.NO %}
          {{ claimRejectedFreeMediationNOForClaimantDashboard(claim) }}
        {% else %}
          {{ claimRejectedFreeMediationYESForClaimantDashboard(claim) }}
        {% endif %}
      {% elif state.status === ClaimStatus.OFFER_SUBMITTED %}
        {{ offerSubmittedForClaimantDashboard(claim) }}
      {% elif state.status === ClaimStatus.OFFER_REJECTED %}
        {{ offerRejectedForClaimantDashboard(claim) }}
      {% elif state.status === ClaimStatus.OFFER_ACCEPTED %}
        {{ offerAcceptedForClaimantDashboard(claim) }}
      {% elif state.status === ClaimStatus.OFFER_SETTLEMENT_REACHED %}
        {{ offerSettlementReachedDashboard(claim) }}
      {% else %}
        <p>
          {{ caseStatusForClaimant(state.status, claim, url) }}
        </p>
      {% endif %}
    </div>
  {% endfor %}
{% endmacro %}

{% macro caseHistoryForDefendantDashboard(claim, url, isAfter4pm) %}
  {% for state in claim.stateHistory %}
    <div class="status-block">
      {% if state.status === ClaimStatus.CCJ_REQUESTED %}
        {{ ccjRequesterForDefendantDashboard(claim) }}
      {% elif state.status === ClaimStatus.CLAIM_REJECTED %}
        {% if claim.response.defenceType === DefenceType.ALREADY_PAID %}
          {{ claimRejectedAlreadyPaidForDefendantDashboard(claim) }}
        {% endif %}
        {% if claim.response.freeMediation === FreeMediationOption.NO %}
          {{ claimRejectedFreeMediationNOForDefendantDashboard(claim) }}
        {% else %}
          {{ claimRejectedFreeMediationYESForDefendantDashboard(claim) }}
        {% endif %}
        {{ settleOutOfCourtOption (claim) }}
      {% elif state.status === ClaimStatus.OFFER_SUBMITTED %}
        {{ offerSubmittedForDefendantDashboard(claim) }}
      {% elif state.status === ClaimStatus.OFFER_REJECTED %}
        {{ offerRejectedForDefendantDashboard(claim) }}
      {% elif state.status === ClaimStatus.OFFER_ACCEPTED %}
        {{ offerAcceptedForDefendantDashboard(claim) }}
      {% elif state.status === ClaimStatus.OFFER_SETTLEMENT_REACHED %}
        {{ offerSettlementReachedDashboard(claim) }}
      {% else %}
        <p>
          {{ caseStatusForDefendant(claim.status, claim, DashboardUrlHelper.getStatusUrl(claim), isAfter4pm) }}
        </p>
      {% endif %}
    </div>
  {% endfor %}
{% endmacro %}

{% macro settleOutOfCourtOption (claim) %}
  <h2 class="heading-medium">{{ t('Settle out of court') }}</h2>
  <p>{{ t('You may still <a href="{{ link }}">settle the claim out of court</a>. For example you could offer to fix goods you sold the claimant or suggest a payment.',
      { link: OfferPaths.settleOutOfCourtPage.evaluateUri({ externalId: claim.externalId }) }) | safe }}</p>
  <p>{{ t('You can avoid getting a County Court Judgment if the claimant accepts your offer.') }}</p>
{% endmacro %}
