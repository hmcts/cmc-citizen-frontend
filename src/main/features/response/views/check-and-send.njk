{% extends "layout.njk" %}

{% from "table.njk" import tableStart,tableEnd, row, rowWithMultipleValue %}
{% from "form.njk" import csrfProtection, submitButton, errorSummary, checkboxGroup %}
{% from "statement-of-truth.njk" import statementOfTruth %}
{% from "party/details.njk" import partyDetailsSummaryFragment %}

{% set title = t("Money claim") %}
{% set heading = t("Check your answers before submitting your response") %}

{% block content %}
  <form novalidate method="post">
    {{ csrfProtection(csrf) }}

    {{ tableStart("yourDetails", "Your details") }}
    {{
      partyDetailsSummaryFragment(
        partyDetails = draft.defendantDetails.partyDetails,
        changeLinks = {
          contactPerson: paths.defendantYourDetailsPage.evaluateUri({ externalId: claim.externalId }),
          address: paths.defendantYourDetailsPage.evaluateUri({ externalId: claim.externalId }),
          dateOfBirth: paths.defendantDateOfBirthPage.evaluateUri({ externalId: claim.externalId })
        }
      )
    }}
    {{ row("Phone:", draft.defendantDetails.mobilePhone.number, paths.defendantMobilePage.evaluateUri({ externalId: claim.externalId })) }}

    {{ tableEnd() }}

    {{ tableStart("moneyOwed", "Do you owe the money claimed?") }}

    {{ row('Do you owe the money claimed?', t(draft.response.type.displayValue) | capitalize, paths.responseTypePage.evaluateUri({ externalId: claim.externalId })) }}

    {% if draft.response.type.value === 'OWE_SOME_PAID_NONE' %}
      {% if draft.rejectPartOfClaim.option === 'paidWhatBelievedWasOwed' %}
        {% set rejectPartOption = 'I’ve paid what I believe I owe' %}
      {% endif %}

      {% if draft.rejectPartOfClaim.option === 'amountTooHigh' %}
        {% set rejectPartOption = 'The claim amount is too much' %}
      {% endif %}

      {{ row('Why are you rejecting part of this claim?', t(rejectPartOption) | capitalize, paths.defenceRejectPartOfClaimPage.evaluateUri({ externalId: claim.externalId })) }}
    {% endif %}

    {% if draft.response.type.value === 'OWE_NONE' %}
      {% if draft.rejectAllOfClaim.option === 'alreadyPaid' %}
        {% set rejectAllOption = 'I’ve already paid the claim in full' %}
      {% endif %}

      {% if draft.rejectAllOfClaim.option === 'dispute' %}
        {% set rejectAllOption = 'I dispute the claim' %}
      {% endif %}

      {% if draft.rejectAllOfClaim.option === 'counterClaim' %}
        {% set rejectAllOption = 'Defend now and also make a counterclaim' %}
      {% endif %}

      {{ row('Why do you reject all of this claim?', t(rejectAllOption) | capitalize, paths.defenceRejectAllOfClaimPage.evaluateUri({ externalId: claim.externalId })) }}
    {% endif %}

    {{ tableEnd() }}

    {% if draft.response.type.value === 'OWE_SOME_PAID_NONE' %}
    {{ tableStart("yourResponse", "Your response") }}

    {% if draft.rejectPartOfClaim.option === 'amountTooHigh' %}
      {{ row('How much money do you believe you owe?', draft.howMuchIsPaid.text, paths.defendantHowMuchPaid.evaluateUri({ externalId: claim.externalId })) }}
    {% endif %}

    {% if draft.rejectPartOfClaim.option === 'paidWhatBelievedWasOwed' %}
      {{ row('Why this is what you owe?', draft.howMuchOwed.text, paths.defendantHowMuchOwed.evaluateUri({ externalId: claim.externalId })) }}
    {% endif %}

    {% endif %} 

    {% if draft.requireDefence() %}
      {{ row('Your defence', draft.defence.text, '/response/your-defence') }}

      {{ row('Free mediation', t(draft.freeMediation.option) | capitalize, paths.freeMediationPage.evaluateUri({ externalId: claim.externalId })) }}
    {% endif %}

    {{ tableEnd() }}

    {{
      statementOfTruth(
        form,
        label = 'I believe that the facts stated in this claim are true',
        isQualified = (signatureType === 'qualified')
      )
    }}

    {{ submitButton('Submit response') }}

    <input type="hidden" name="type" value="{{ form.model.type }}">
  </form>
{% endblock %}
