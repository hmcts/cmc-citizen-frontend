{% extends "layout.njk" %}
{% from "form.njk" import csrfProtection, saveAndContinueButton, errorSummary, expandibleCheckboxOption %}
{% from "../macro/statement-of-means/incomeExpenseSource.njk" import incomeExpenseSource %}

{% block additional_scripts %}
  {% include "expandible-checkbox-option-scripts.njk" %}
  {% include "income-expense-calculation-scripts.njk" %}
{% endblock %}

{% set heading = 'What regular income do you receive?' %}

{% block content %}

<p>{{ t('Select all that apply. The information you enter must be truthful and accurate.') }} </p>

<div class="grid-row">
  <div class="column-two-thirds">

    <form method="post" novalidate class="income-expense-calculation">
      {{ csrfProtection(csrf) }}

      <div class="form-group">
        {{ incomeSource(form, name = 'salary', label = 'Income from your job', hint = 'Include wages, overtime, commission, bonuses') }}
        {{ incomeSource(form, name = 'universalCredit', label = 'Universal Credit') }}
        {{ incomeSource(form, name = 'jobseekerAllowanceIncome', label = 'Jobseeker’s Allowance (income based)') }}
        {{ incomeSource(form, name = 'jobseekerAllowanceContribution', label = 'Jobseeker’s Allowance (contribution based)') }}
        {{ incomeSource(form, name = 'incomeSupport', label = 'Income Support') }}
        {{ incomeSource(form, name = 'workingTaxCredit', label = 'Working Tax Credit') }}
        {{ incomeSource(form, name = 'childTaxCredit', label = 'Child Tax Credit') }}
        {{ incomeSource(form, name = 'childBenefit', label = 'Child Benefit') }}
        {{ incomeSource(form, name = 'councilTaxSupport', label = 'Council Tax Support') }}
        {{ incomeSource(form, name = 'pension', label = 'Pension (paid to you)') }}
      </div>
      {# <div class="statement-of-means-container">
        {% if form.model and form.model.rows.length > 0 %}
        <div class="multiline">
          <div class="multiline-rows">
            <div class="triple-column mobile-hide">
              <div class="column-1 mobile-hide">
                <label id="description-label"  class="form-label-bold">{{ t('Name of income') }}</label>
              </div>
              <div class="column-4 mobile-hide">
                <label id="amount-label"  class="form-label-bold">{{ t('Amount') }}</label>
              </div>
            </div>

            {% for row in form.model.rows %}
              {{ incomeRow(loop.index0, form) }}
            {% endfor %}
          </div>
        </div>
        {% endif %}

        {% if form.model and form.model.canAddMoreRows() %}
          <div id="add-event-container" class="form-group">
            {{ linkButton('Add another source of income', 'action[addRow]', 'button button-secondary') }}
          </div>
        {% endif %}
      </div> #}

      <p id="total" class="heading-small">
        Total monthly income: £<span class="total-monthly-income-expense"> {{ totalMonthlyIncomeExpense | default('0.00') }} </span>
      </p>

      {{ saveAndContinueButton() }}  
      
    </form>
  </div>
</div>

{% endblock %}

{% macro incomeSource(form, name, label, hint) %}
  {% set capitalisedName = name.slice(0, 1) | upper + name.slice(1) %}
  {% set checkboxName = 'has' + capitalisedName + 'Source' %}

  {% call expandibleCheckboxOption(label, checkboxName, form, value = 'true', checked = form.valueFor(checkboxName) === true) -%}
    {{ incomeExpenseSource(form, name = name + 'Source', amountLabel = 'Amount received', amountHint = hint, scheduleLabel = 'Received every') }}
  {%- endcall %}
{% endmacro %}
