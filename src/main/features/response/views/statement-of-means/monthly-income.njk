{% extends "layout.njk" %}
{% from "form.njk" import csrfProtection, linkButton, saveAndContinueButton, errorSummary, option, linkButton %}
{% from "../macro/statement-of-means/incomeExpenseSource.njk" import incomeExpenseSource %}

{% block additional_scripts %}
  {% include "expandible-checkbox-option-scripts.njk" %}
  {% include "income-expense-calculation-scripts.njk" %}
{% endblock %}

{% set heading = 'What regular income do you receive?' %}

{% block content %}

<p>{{ t('Select all that apply. The information you enter must be truthful and accurate.') }} </p>

<div class="grid-row">
  <div class="column-two-thirds">

    <form method="post" novalidate class="income-expense-calculation">
      {{ csrfProtection(csrf) }}

      <div class="form-group">
        {{ incomeSource(form, name = 'salarySource', label = 'Income from your job', hint = 'Include wages, overtime, commission, bonuses') }}
        {{ incomeSource(form, name = 'universalCreditSource', label = 'Universal Credit') }}
        {{ incomeSource(form, name = 'jobseekerAllowanceIncomeSource', label = 'Jobseeker’s Allowance (income based)') }}
        {{ incomeSource(form, name = 'jobseekerAllowanceContributionSource', label = 'Jobseeker’s Allowance (contribution based)') }}
        {{ incomeSource(form, name = 'incomeSupportSource', label = 'Income Support') }}
        {{ incomeSource(form, name = 'workingTaxCreditSource', label = 'Working Tax Credit') }}
        {{ incomeSource(form, name = 'childTaxCreditSource', label = 'Child Tax Credit') }}
        {{ incomeSource(form, name = 'childBenefitSource', label = 'Child Benefit') }}
        {{ incomeSource(form, name = 'councilTaxSupportSource', label = 'Council Tax Support') }}
        {{ incomeSource(form, name = 'pensionSource', label = 'Pension (paid to you)') }}
      </div>

      {{ linkButton('Recalculate total monthly income', 'action[calculateMontlyIncome]', 'button button-secondary calculate-montly-income-expense') }}

      <p class="heading-small">
        Total monthly income: £<span class="total-monthly-income-expense"> {{ totalMonthlyIncomeExpense | default('0.00') }} </span>
      </p>

      {{ saveAndContinueButton() }}

    </form>
  </div>
</div>

{% endblock %}

{% macro incomeSource(form, name, label, hint) %}
  {% set checkboxName = name + 'Declared' %}

  {% call expandibleCheckboxOption(form = form, name = checkboxName, value = 'true', checked = form.valueFor(name), label = label) %}
    {{ incomeExpenseSource(form = form, name = name, amountLabel = 'Amount received', amountHint = hint, scheduleLabel = 'Received every') }}
    {{ linkButton(name = 'action[reset][' + name + ']', label = 'Reset this income source', class = 'link-button js-hidden') }}
  {% endcall %}
{% endmacro %}

{% macro expandibleCheckboxOption(label, name, form, value, hint = '', checked = false, bold = false) %}
  {% set expandiblePanelId = name + '-' + value | replace(' ', '') %}
  <div class="expandible-checkbox-option">
    <h3 class="heading-medium expandible">{{ t(label) }}</h3>
    {{ option(form = form, name = name, value = value, type = 'checkbox', checked = checked, label = label, hint = hint, bold = bold, hidden = true, className = 'expandible visually-hidden', dataTarget = expandiblePanelId) }}
    <div class="panel panel-border-narrow expandible" id="{{ expandiblePanelId }}">
      {{ caller() }}
    </div>
    <br />
  </div>
{% endmacro %}
