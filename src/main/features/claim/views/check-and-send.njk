{% extends "layout.njk" %}
{% from "includes/macros/table.njk" import tableStart,tableEnd, row, rowWithMultipleValue %}
{% from "includes/macros/form.njk" import csrfProtection, submitButton, errorSummary, checkboxGroup %}
{% from "includes/macros/statement-of-truth.njk" import statementOfTruth %}

{% set title = t("Money claim") %}
{% set heading = t("Check your answers before submitting your claim") %}
{% set partyType = draftClaim.claimant.partyDetails.type %}
{% set claimantPartyType = draftClaim.claimant.partyDetails.type %}
{% set defendantPartyType = draftClaim.defendant.partyDetails.type %}

{% if draftClaim.claimant.partyDetails.hasCorrespondenceAddress %}
  {% set correspondenceAddressLines = [
    draftClaim.claimant.partyDetails.correspondenceAddress.line1,
    draftClaim.claimant.partyDetails.correspondenceAddress.line2,
    draftClaim.claimant.partyDetails.correspondenceAddress.city,
    draftClaim.claimant.partyDetails.correspondenceAddress.postcode
  ] %}
{% else %}
  {% set correspondenceAddressLines = [t('Same as address')] %}
{% endif %}

{% block content %}
  <form novalidate method="post">
    {{ csrfProtection(csrf) }}

    {{ tableStart("yourDetails", "Your details") }}
    {{ row("Name:", draftClaim.claimant.partyDetails.name) }}
    {% if (partyType === 'company' or partyType === 'organisation') %}
      {% if (contactPerson) %}
        {{ row("Contact Name:", contactPerson) }}
      {% endif %}
    {% endif %}
    {% if (partyType === 'soleTrader') %}
      {{ row("Business name:", 'Trading as ' + businessName ) }}
    {% endif %}
    {{
      rowWithMultipleValue(
        label = "Address:",
        values = [draftClaim.claimant.partyDetails.address.line1,
          draftClaim.claimant.partyDetails.address.line2,
          draftClaim.claimant.partyDetails.address.city,
          draftClaim.claimant.partyDetails.address.postcode],
        bottomBorder = false
      )
    }}
    {{
      rowWithMultipleValue(
        label = "Correspondence address:",
        values = correspondenceAddressLines
      )
    }}
    {% if (partyType === 'individual' or partyType === 'soleTrader') %}
      {{ row("Date of birth:", dateOfBirth.date.asString() | date) }}
    {% endif %}
    {{ row("Phone:", draftClaim.claimant.mobilePhone.number) }}
    {{ tableEnd() }}



    {{ tableStart("theirDetails", "Their details") }}
    {{ row('Name:', draftClaim.defendant.partyDetails.name) }}
    {% if (defendantPartyType === 'company' or defendantPartyType === 'organisation') %}
      {% if (defendantContactPerson) %}
        {{ row("Contact Name:", defendantContactPerson) }}
      {% endif %}
    {% endif %}
    {% if (defendantPartyType === 'soleTrader') %}
      {{ row("Business name:", 'Trading as ' + defendantBusinessName ) }}
    {% endif %}
    {{ rowWithMultipleValue("Address:", [
    draftClaim.defendant.partyDetails.address.line1,
    draftClaim.defendant.partyDetails.address.line2,
    draftClaim.defendant.partyDetails.address.city,
    draftClaim.defendant.partyDetails.address.postcode]) }}
    {{ row("Email:", draftClaim.defendant.email.address) }}
    {{ tableEnd() }}

    {{ tableStart("claimAmount", "Claim amount") }}
    {{ row("Claim amount:", claimAmountTotal.claimAmount | numeral) }}

    {% if (interestClaimed === true) %}
      {% if (draftClaim.interest.rate) %}
        {{ row("Interest rate:", draftClaim.interest.rate | numeral("0,0.00") + "\% \(" + draftClaim.interest.type + "\)" ) }}
      {% endif %}
      {% if payAtSubmission === false %}
        {{ row("Date interest is claimed from:", draftClaim.interestDate.date.asString() | date ) }}
      {% else %}
        {{ row("Date interest is claimed from:", t( 'Date you submit the claim' )) }}
      {% endif %}
      {% if (claimAmountTotal.interestAmount) %}
        {{ row("Interest:", claimAmountTotal.interestAmount | numeral) }}
      {% endif %}
    {% else %}
      {{ row("Interest rate:", t( "I don't want to claim interest" ) ) }}
    {% endif %}

    {{ row("Claim fee:", claimAmountTotal.feeAmount | numeral) }}
    {{ row("Total amount you're claiming:",  claimAmountTotal.totalAmount | numeral) }}
    {{ tableEnd() }}

    {{ tableStart("claimDetails", "Claim details") }}
    {{ row("Why you're owed the money:", draftClaim.reason.reason ) }}
    {{ tableEnd() }}

    <div class="form-group">
      {{ statementOfTruth(form, 'I believe that the facts stated in this claim are true') }}

      {% set submitButtonLabel = t('Submit and continue to payment ') %}
      {{ submitButton(submitButtonLabel + '(' + (claimAmountTotal.feeAmount | numeral) + ')') }}
    </div>
  </form>
{% endblock %}
