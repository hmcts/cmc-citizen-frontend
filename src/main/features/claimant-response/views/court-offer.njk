{% extends "layout.njk" %}

{% from "form.njk" import csrfProtection, submitButton, errorSummary %}
{% from "./macro/paymentPlanTable.njk" import paymentPlanTable %}
{% from "financialDetails.njk" import financialDetailsTable %}

{% set heading = 'Your instalments are more than the defendant can afford' %}
{% set defendantName = claim.claimData.defendant.name %}

{% macro repaymentPlanBlock(heading = 'The court`s proposed repayment plan', repaymentPlan, paymentPlan) %}
  {% if heading %}
    <h2 class="heading-medium">{{ t(heading) }}</h2>
  {% endif %}

  {{ paymentPlanTable(
    id = 'payment-table',
    instalmentAmount = repaymentPlan.instalmentAmount,
    paymentFrequency = repaymentPlan.paymentFrequency,
    firstPaymentDate = repaymentPlan.firstPaymentDate,
    lastPaymentOn = paymentPlan.getLastPaymentDate(),
    lengthOfPayment = paymentPlan.getPaymentLength()
  )
  }}
{% endmacro %}

{% block content %}
  <div class="grid-row">
    <div class="column-two-thirds">
      <p>{{ t('Based on the financial details provided by the defendant, we do not believe they would be able to meet these requirements.') }}</p>

      <p>{{ t('The court affordability calculator has proposed the below repayment plan as the maximum the defendant can repay.') }}</p>

      {% if claim.response.paymentIntention.paymentOption === domain.PaymentOption.INSTALMENTS %}
        {{
        repaymentPlanBlock(
          repaymentPlan = claim.response.paymentIntention.repaymentPlan,
          paymentPlan = paymentPlan
        )
        }}
      {% endif %}

      <form novalidate method="post">
        {{ csrfProtection(csrf) }}

        {{
        radioGroup(
          label = 'Do you want to accept the court`s proposed repayment plan?',
          labelForScreenReadersOnly = true,
          form = form,
          name = name,
          options = [
          {
            label: 'I want to accept this repayment plan',
            value: FormaliseRepaymentPlanOption.SIGN_SETTLEMENT_AGREEMENT.value,
            checked: (form.valueFor(name).value === FormaliseRepaymentPlanOption.SIGN_SETTLEMENT_AGREEMENT.value),
            bold: false
          },
          {
            label: 'I want a judge to make a repayment plan',
            value:  FormaliseRepaymentPlanOption.REQUEST_COUNTY_COURT_JUDGEMENT.value,
            checked: (form.valueFor(name).value === FormaliseRepaymentPlanOption.REQUEST_COUNTY_COURT_JUDGEMENT.value),
            bold: false
          }
        ]
        )
        }}

        {{ saveAndContinueButton() }}
      </form>

    </div>
  </div>
{% endblock %}
