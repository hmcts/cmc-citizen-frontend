import { IsDefined, IsIn, ValidateIf, MaxLength } from '@hmcts/class-validator'
import { IsNotBlank } from '@hmcts/cmc-validators'
import { ValidationErrors as CommonValidationErrors } from 'forms/validation/validationErrors'
import { YesNoOption } from 'models/yesNoOption'
import { CompletableTask } from 'models/task'

class ValidationErrors {
  static HELP_WITH_FEES_NUMBER_REQUIRED: string = 'Question 2: If you have answered “yes” to question 1, in what way/s are you/ the witness vulnerable and what steps, support or adjustments do you wish the Court to consider?'
  static HELP_WITH_FEES_NUMBER_ERROR: string = 'Question 2: If you have answered “yes” to question 1, in what way/s are you/ the witness vulnerable and what steps, support or adjustments do you wish the Court to consider? (Max lenght 256 characters reached)'
}

export class VulnerabilityQuestions implements CompletableTask {

  @IsDefined({ message: CommonValidationErrors.YES_NO_REQUIRED })
  @IsIn(YesNoOption.all(), { message: CommonValidationErrors.YES_NO_REQUIRED })
  declared?: YesNoOption

  @ValidateIf(o => o.declared === YesNoOption.YES)
  @IsDefined({ message: ValidationErrors.HELP_WITH_FEES_NUMBER_REQUIRED })
  @IsNotBlank({ message: ValidationErrors.HELP_WITH_FEES_NUMBER_REQUIRED })
  @MaxLength(256, { message: ValidationErrors.HELP_WITH_FEES_NUMBER_ERROR })
  vulnerabilityQuestions?: string

  constructor (declared?: YesNoOption, helpWithFeesNumber?: string) {
    this.declared = declared
    this.vulnerabilityQuestions = helpWithFeesNumber
  }

  static fromObject (value?: any): VulnerabilityQuestions {
    if (!value) {
      return value
    }

    return new VulnerabilityQuestions(YesNoOption.fromObject(value.declared), value.helpWithFeesNumber)
  }

  deserialize (input?: any): VulnerabilityQuestions {
    if (input) {
      this.declared = input.declared
      this.vulnerabilityQuestions = input.helpWithFeesNumber
    }

    return this
  }

  isCompleted (): boolean {
    return true
  }
}
